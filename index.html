<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Radar SLO Pro - Color Coding</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background: #1a1a1a; }
        #map { height: 100vh; width: 100vw; }

        /* BARVNI STILI ZA IKONE */
        .icon-waze { border: 3px solid #33ccff; background: rgba(51, 204, 255, 0.2); }
        .icon-gold { border: 3px solid #ffd700; background: rgba(255, 215, 0, 0.2); }
        .icon-dars { border: 3px solid #ff9800; background: rgba(255, 152, 0, 0.2); }
        .icon-user { border: 3px solid #ff1744; background: rgba(255, 23, 68, 0.2); }

        .base-marker {
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            width: 40px !important;
            height: 40px !important;
        }

        /* INFO KARTICA */
        .info-card { background: #222; color: white; padding: 10px; border-radius: 8px; border-left: 5px solid; }
        .popup-waze { border-color: #33ccff; }
        .popup-gold { border-color: #ffd700; }
        .popup-dars { border-color: #ff9800; }
        .popup-user { border-color: #ff1744; }

        #legend {
            position: absolute; top: 10px; left: 10px; z-index: 1000;
            background: rgba(0,0,0,0.85); padding: 10px; border-radius: 10px;
            color: white; font-size: 10px; border: 1px solid #444;
        }
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

    <div id="legend">
        <b>VIRI PODATKOV:</b><br>
        <span class="dot" style="background: #33ccff;"></span> WAZE<br>
        <span class="dot" style="background: #ffd700;"></span> RADARBOT GOLD<br>
        <span class="dot" style="background: #ff9800;"></span> DARS / AMZS<br>
        <span class="dot" style="background: #ff1744;"></span> MOJA PRIJAVA
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', { zoomControl: false }).setView([46.05, 14.50], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        function vnesiDogodek(lat, lon, tip, ikona, opis, vir, omejitev) {
            // Doloƒçimo barvno klaso glede na vir
            let barvaKlasa = "";
            let popupKlasa = "";
            if(vir === "WAZE") { barvaKlasa = "icon-waze"; popupKlasa = "popup-waze"; }
            else if(vir === "RADARBOT GOLD") { barvaKlasa = "icon-gold"; popupKlasa = "popup-gold"; }
            else if(vir === "DARS/AMZS") { barvaKlasa = "icon-dars"; popupKlasa = "popup-dars"; }
            else { barvaKlasa = "icon-user"; popupKlasa = "popup-user"; }

            var customIcon = L.divIcon({
                html: `<div class="base-marker ${barvaKlasa}">${ikona}</div>`,
                className: 'dummy',
                iconSize: [40, 40]
            });

            var content = `
                <div class="info-card ${popupKlasa}">
                    <h4 style="margin:0; color:#fff;">${tip}</h4>
                    <p style="margin:5px 0; font-size:12px;">${opis}</p>
                    ${omejitev ? `<b style="color:#ff1744;">Omejitev: ${omejitev} km/h</b><br>` : ''}
                    <small>VIR: ${vir}</small>
                </div>
            `;

            L.marker([lat, lon], {icon: customIcon}).addTo(map).bindPopup(content);
        }

        // --- ROBOT POLNI MAPO ---
        vnesiDogodek(46.058, 14.505, "POLICIJA", "üëÆ", "Laserska kontrola na uvozu.", "WAZE", "50");
        vnesiDogodek(46.075, 14.530, "FIKSNI RADAR", "üì∏", "Opozorilo iz baze Gold.", "RADARBOT GOLD", "60");
        vnesiDogodek(46.120, 14.580, "DELA NA CESTI", "üöß", "Obvoz urejen.", "DARS/AMZS", "40");
        vnesiDogodek(46.040, 14.480, "ZASTOJ", "üöó", "Moƒçan zastoj v kri≈æi≈°ƒçu.", "MOJA PRIJAVA", "");

        map.locate({watch: true, enableHighAccuracy: true});
        map.on('locationfound', function(e) {
            if (!window.uMarker) {
                window.uMarker = L.circleMarker(e.latlng, {radius: 8, color: '#ffd700', fillColor: 'white', fillOpacity: 1}).addTo(map);
            } else { window.uMarker.setLatLng(e.latlng); }
        });
    </script>
</body>
</html>
