<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Radar SLO Pro - Clean Drive</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background: #1a1a1a; overflow: hidden; }
        #map { height: 100vh; width: 100vw; }

        /* RAZDALJA LEVO ZGORAJ */
        #dist-box {
            position: absolute; top: 20px; left: 20px; z-index: 1000;
            width: 60px; height: 60px; background: rgba(0,0,0,0.8);
            border: 2px solid #33ccff; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 14px;
        }

        /* HITROST IN OMEJITEV DESNO SPODAJ */
        #bottom-right-stats {
            position: absolute; bottom: 20px; right: 20px; z-index: 1000;
            display: flex; gap: 10px; align-items: flex-end;
        }
        .stat-circle {
            width: 70px; height: 70px; border-radius: 50%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; color: white; background: black;
        }
        #speed-circle { border: 4px solid #33ccff; }
        #limit-circle { border: 5px solid #ff1744; background: white; color: black; font-size: 24px; }

        /* RDEƒåA IKONA ZA PRIJAVO SPODAJ SREDINA */
        #main-report-btn {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 1000; width: 80px; height: 80px; background: #ff1744;
            border-radius: 50%; border: 4px solid white; color: white;
            font-size: 40px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: pointer;
        }

        /* Skrit meni za prijavo */
        #report-menu {
            position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
            z-index: 1001; display: none; gap: 10px; background: rgba(0,0,0,0.9);
            padding: 15px; border-radius: 20px; border: 1px solid #444;
        }
        .menu-item { font-size: 30px; cursor: pointer; padding: 10px; }

    </style>
</head>
<body>

    <div id="dist-box">
        <span id="dist-val">--</span>
        <small style="font-size: 9px;">KM</small>
    </div>

    <div id="main-report-btn" onclick="toggleReportMenu()">+</div>
    <div id="report-menu">
        <span class="menu-item" onclick="oddaj('POLICIJA', 'üëÆ')">üëÆ</span>
        <span class="menu-item" onclick="oddaj('RADAR', 'üì∏')">üì∏</span>
        <span class="menu-item" onclick="oddaj('DELA', 'üöß')">üöß</span>
        <span class="menu-item" onclick="oddaj('NESREƒåA', 'üí•')">üí•</span>
    </div>

    <div id="bottom-right-stats">
        <div id="limit-circle" class="stat-circle">50</div>
        <div id="speed-circle" class="stat-circle">
            <span id="current-speed" style="font-size: 26px;">0</span>
            <small style="font-size: 10px;">km/h</small>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', { zoomControl: false }).setView([46.05, 14.50], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        var userPos = null;
        var vsiRadarji = []; // Seznam za preverjanje razdalje

        function toggleReportMenu() {
            var menu = document.getElementById('report-menu');
            menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
        }

        map.locate({watch: true, enableHighAccuracy: true});
        map.on('locationfound', function(e) {
            userPos = e.latlng;
            var speed = e.speed ? Math.round(e.speed * 3.6) : 0;
            document.getElementById('current-speed').innerText = speed;

            if (!window.uMarker) {
                window.uMarker = L.circleMarker(e.latlng, {radius: 10, color: '#33ccff', fillColor: 'white', fillOpacity: 1, weight: 3}).addTo(map);
            } else { window.uMarker.setLatLng(e.latlng); }
            
            map.setView(e.latlng, 16);
            preveriBli≈æino(e.latlng);
        });

        function oddaj(tip, ikona) {
            alert("Javljeno: " + tip);
            toggleReportMenu();
            // Tukaj doda≈° svoj GitHub fetch...
        }

        // GLASOVNO OPOZORILO NA 1 KM
        var zadnjeOpozorilo = 0;
        function preveriBli≈æino(pos) {
            vsiRadarji.forEach(r => {
                var dist = map.distance(pos, [r.lat, r.lon]);
                if (dist < 1000 && dist > 800 && Date.now() - zadnjeOpozorilo > 60000) {
                    var msg = new SpeechSynthesisUtterance("Pozor, " + r.tip + " ƒçez en kilometer.");
                    msg.lang = 'sl-SI';
                    window.speechSynthesis.speak(msg);
                    zadnjeOpozorilo = Date.now();
                }
            });
        }
    </script>
</body>
</html>
