<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Radar SLO Pro - Smart Tracking</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background: #1a1a1a; overflow: hidden; }
        #map { height: 100vh; width: 100vw; }

        /* GUMB NAZAJ NA LOKACIJO (Spodaj levo) */
        #recenter-btn {
            position: absolute; bottom: 30px; left: 20px; z-index: 1000;
            width: 60px; height: 60px; background: #33ccff; color: white;
            border-radius: 50%; border: 3px solid white; display: none; /* Skrit dokler ne premakne≈° mape */
            align-items: center; justify-content: center; font-size: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); cursor: pointer;
        }

        /* OSTALI ELEMENTI (Razdalja, Hitrost, Prijava - ≈æe urejeno) */
        #dist-box { position: absolute; top: 20px; left: 20px; z-index: 1000; width: 60px; height: 60px; background: rgba(0,0,0,0.8); border: 2px solid #33ccff; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px; }
        #bottom-right-stats { position: absolute; bottom: 20px; right: 20px; z-index: 1000; display: flex; gap: 10px; align-items: flex-end; }
        .stat-circle { width: 70px; height: 70px; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; color: white; background: black; }
        #speed-circle { border: 4px solid #33ccff; }
        #limit-circle { border: 5px solid #ff1744; background: white; color: black; font-size: 24px; }
        #main-report-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 80px; height: 80px; background: #ff1744; border-radius: 50%; border: 4px solid white; color: white; font-size: 40px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

    <div id="dist-box"> <span id="dist-val">--</span> <small style="font-size: 9px;">KM</small> </div>

    <div id="recenter-btn" onclick="recenterMap()">üéØ</div>

    <div id="main-report-btn" onclick="toggleReportMenu()">+</div>

    <div id="bottom-right-stats">
        <div id="limit-circle" class="stat-circle">50</div>
        <div id="speed-circle" class="stat-circle">
            <span id="current-speed" style="font-size: 26px;">0</span>
            <small style="font-size: 10px;">km/h</small>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map', { zoomControl: false }).setView([46.05, 14.50], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        var userPos = null;
        var isFollowing = true; // Spremenljivka, ki pove ali sledimo lokaciji

        // Zaznaj roƒçni premik mape
        map.on('movestart', function() {
            // ƒåe je premik povzroƒçil uporabnik (in ne koda), izklopi sledenje
            // Uporabimo majhen trik s preverjanjem dogodka
        });

        // Leaflet nima direktnega 'userdrag' dogodka, zato uporabimo 'dragstart'
        map.on('dragstart', function() {
            isFollowing = false;
            document.getElementById('recenter-btn').style.display = 'flex';
        });

        function recenterMap() {
            if (userPos) {
                isFollowing = true;
                map.flyTo(userPos, 16); // Gladko skoƒçi nazaj
                document.getElementById('recenter-btn').style.display = 'none';
            }
        }

        map.locate({watch: true, enableHighAccuracy: true});
        map.on('locationfound', function(e) {
            userPos = e.latlng;
            var speed = e.speed ? Math.round(e.speed * 3.6) : 0;
            document.getElementById('current-speed').innerText = speed;

            if (!window.uMarker) {
                window.uMarker = L.circleMarker(e.latlng, {radius: 10, color: '#33ccff', fillColor: 'white', fillOpacity: 1, weight: 3}).addTo(map);
            } else {
                window.uMarker.setLatLng(e.latlng);
            }
            
            // Samodejno centriraj SAMO ƒåE je isFollowing true
            if (isFollowing) {
                map.setView(e.latlng, map.getZoom());
            }
        });

        // ... ostale funkcije za prijavo in menu ostanejo enake ...
    </script>
</body>
</html>
